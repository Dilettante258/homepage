---
type SortOption = { value: string; label: string };
type LayoutMode = "grid" | "list" | "tiling";

type Props = {
  tags: string[];
  tagLabels?: Record<string, string>;
  filterAllLabel: string;
  sortByLabel: string;
  sortOptions: SortOption[];
  layouts: LayoutMode[];
  layoutLabels: Record<string, string>;
  defaultLayout?: LayoutMode;
};

const {
  tags,
  tagLabels,
  filterAllLabel,
  sortByLabel,
  sortOptions,
  layouts,
  layoutLabels,
  defaultLayout = "grid",
} = Astro.props;

const layoutIcons: Record<LayoutMode, string> = {
  grid: `<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
    <rect x="1" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="9" y="1" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="1" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="9" y="9" width="6" height="6" rx="1" stroke="currentColor" stroke-width="1.5"/>
  </svg>`,
  list: `<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
    <rect x="1" y="1" width="14" height="4" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="1" y="7" width="14" height="4" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="1" y="13" width="14" height="2" rx="1" stroke="currentColor" stroke-width="1.5"/>
  </svg>`,
  tiling: `<svg width="16" height="16" viewBox="0 0 16 16" fill="none">
    <rect x="1" y="1" width="6" height="9" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="9" y="1" width="6" height="5" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="1" y="12" width="6" height="3" rx="1" stroke="currentColor" stroke-width="1.5"/>
    <rect x="9" y="8" width="6" height="7" rx="1" stroke="currentColor" stroke-width="1.5"/>
  </svg>`,
};
---

<div class="toolbar">
  <div class="filters" role="group" aria-label="Filter by tag">
    <button class="filter-btn active" data-tag="all">
      {filterAllLabel}
    </button>
    {
      tags.map((tag) => (
        <button class="filter-btn" data-tag={tag}>
          {tagLabels?.[tag] ?? tag}
        </button>
      ))
    }
  </div>
  <div class="toolbar__right">
    <div class="sort-group">
      <label for="sort-select" class="sort-label">{sortByLabel}</label>
      <select id="sort-select" class="sort-select">
        {sortOptions.map((opt) => <option value={opt.value}>{opt.label}</option>)}
      </select>
    </div>
    {layouts.length > 0 && (
      <div class="layout-toggle" role="group" aria-label="Layout mode">
        {layouts.map((mode) => (
          <button
            class:list={["layout-btn", { active: mode === defaultLayout }]}
            data-layout={mode}
            title={layoutLabels[mode] ?? mode}
            aria-label={layoutLabels[mode] ?? mode}
          >
            <Fragment set:html={layoutIcons[mode]} />
          </button>
        ))}
      </div>
    )}
  </div>
</div>

<style>
  .toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    margin-top: 1.2rem;
    flex-wrap: wrap;
  }

  .toolbar__right {
    display: flex;
    align-items: center;
    gap: 0.6rem;
  }

  .filters {
    display: flex;
    gap: 0.35rem;
    flex-wrap: wrap;
  }

  .filter-btn {
    padding: 0.4rem 0.8rem;
    border-radius: 999px;
    border: 1px solid var(--stroke);
    background: var(--surface-hover);
    color: var(--muted);
    cursor: pointer;
    font: inherit;
    font-size: 0.85rem;
    transition:
      background 0.2s,
      color 0.2s,
      border-color 0.2s;
  }

  .filter-btn:hover {
    color: var(--text);
    border-color: var(--border-hover);
  }

  .filter-btn.active {
    color: var(--text);
    border-color: var(--primary-border);
    background: linear-gradient(120deg, var(--primary-bg), var(--accent-bg));
  }

  .sort-group {
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .sort-label {
    font-size: 0.85rem;
    color: var(--muted);
    white-space: nowrap;
  }

  .sort-select {
    padding: 0.4rem 0.8rem;
    border-radius: 999px;
    border: 1px solid var(--stroke);
    background: var(--surface-hover);
    color: var(--text);
    font: inherit;
    font-size: 0.85rem;
    cursor: pointer;
    transition: border-color 0.2s;
  }

  .sort-select:hover,
  .sort-select:focus-visible {
    border-color: var(--border-hover);
    outline: none;
  }

  .layout-toggle {
    display: inline-flex;
    gap: 0.25rem;
    border: 1px solid var(--stroke);
    border-radius: 999px;
    padding: 0.15rem;
    background: var(--surface-hover);
  }

  .layout-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 34px;
    height: 34px;
    border-radius: 999px;
    border: none;
    background: transparent;
    color: var(--muted);
    cursor: pointer;
    transition:
      background 0.2s,
      color 0.2s;
  }

  .layout-btn:hover {
    color: var(--text);
  }

  .layout-btn.active {
    background: linear-gradient(120deg, var(--primary-bg), var(--accent-bg));
    color: var(--text);
  }

  .layout-btn :global(svg) {
    width: 16px;
    height: 16px;
  }
</style>
