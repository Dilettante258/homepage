---
import SiteLayout from "../../layouts/SiteLayout.astro";
import { resolveLocale, messages, SUPPORTED_LOCALES } from "../../i18n/strings";
import MailIcon from "../../components/icons/MailIcon.astro";
import GithubIcon from "../../components/icons/GithubIcon.astro";

export function getStaticPaths() {
  return SUPPORTED_LOCALES.map((lang) => ({ params: { lang } }));
}

const { lang } = Astro.params;
const locale = resolveLocale(lang);
const t = messages[locale];

const education = {
  school: {
    en: "Nanjing University of Posts and Telecommunications",
    zh: "南京邮电大学",
  },
  college: {
    en: "School of Artificial Intelligence",
    zh: "人工智能学院",
  },
  major: {
    en: "Data Science and Big Data Technology",
    zh: "数据科学与大数据技术",
  },
  period: "2022.09 – 2026.06",
};

const experiences = [
  {
    company: { en: "DeepWhale (深鲸源)", zh: "深鲸源" },
    department: { en: "Tech", zh: "技术" },
    role: {
      en: "AI Agent Full-stack Dev Intern",
      zh: "AI Agent 全栈开发实习生",
    },
    period: {
      en: `2026.01 – ${t.about.present}`,
      zh: `2026.01 – ${t.about.present}`,
    },
    location: { en: "Shanghai", zh: "上海" },
    current: true,
  },
  {
    company: { en: "EuroDigit S.R.L", zh: "EuroDigit S.R.L" },
    department: { en: "Tech Department", zh: "技术部 · 大前端" },
    role: { en: "Frontend Dev Intern", zh: "前端开发实习生" },
    period: { en: "2025.11 – 2026.01", zh: "2025.11 – 2026.01" },
    location: { en: "Shanghai", zh: "上海" },
    current: false,
  },
  {
    company: { en: "ByteDance", zh: "字节跳动" },
    department: {
      en: "Volcengine · Data Infra – Compute",
      zh: "火山引擎 · Data-基础设施-计算",
    },
    role: { en: "Frontend Dev Intern", zh: "前端开发实习生" },
    period: { en: "2025.06 – 2025.11", zh: "2025.06 – 2025.11" },
    location: { en: "Shanghai", zh: "上海" },
    current: false,
  },
  {
    company: {
      en: "Zhuhai Huanjie Cloud Computing",
      zh: "珠海环界云计算有限公司",
    },
    department: { en: "Sealos", zh: "Sealos" },
    role: { en: "React & Node Dev", zh: "React & Node 开发工程师" },
    period: { en: "2025.03 – 2025.05", zh: "2025.03 – 2025.05" },
    location: { en: "Hangzhou", zh: "杭州" },
    current: false,
  },
  {
    company: { en: "DiShi Smart", zh: "武汉第拾智慧信息科技" },
    department: { en: "Tech – Frontend", zh: "技术-前端" },
    role: { en: "Frontend Dev Intern", zh: "前端开发实习生" },
    period: { en: "2024.07 – 2024.08", zh: "2024.07 – 2024.08" },
    location: { en: "Wuhan", zh: "武汉" },
    current: false,
  },
];
---

<SiteLayout
  locale={locale}
  t={t}
  title={`${t.about.title} · Dilettante258`}
  description={t.about.subtitle}
>
  <section class="about-page" transition:animate="fade">
    <!-- Header -->
    <div class="page-header">
      <p class="subtitle">{t.about.subtitle}</p>
      <h1>{t.about.title}</h1>
    </div>

    <!-- Contact -->
    <div class="contact-bar">
      <a class="contact-chip" href="mailto:wang1m@outlook.com">
        <MailIcon size={16} />
        wang1m@outlook.com
      </a>
      <a
        class="contact-chip"
        href="https://github.com/Dilettante258"
        target="_blank"
        rel="noreferrer"
      >
        <GithubIcon size={16} />
        GitHub
      </a>
    </div>

    <!-- Tech Stack -->
    <div class="section">
      <h2 class="section-title">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M16 18l6-6-6-6"></path>
          <path d="M8 6l-6 6 6 6"></path>
        </svg>
        {t.about.techStackTitle}
      </h2>
      <div class="tech-stack-icons" transition:persist="tech-stack-icons">
        <img
          class="skill-icons dark-only"
          src="https://skillicons.dev/icons?i=nextjs,react,astro,vue,js,ts,vercel,flask,docker,linux,cloudflare,html,css,netlify,latex,md,python&perline=10&theme=dark"
          alt="Tech Stack"
          width="554"
          height="104"
          loading="lazy"
        />
        <img
          class="skill-icons light-only"
          src="https://skillicons.dev/icons?i=nextjs,react,astro,vue,js,ts,vercel,flask,docker,linux,cloudflare,html,css,netlify,latex,md,python&perline=10&theme=light"
          alt="Tech Stack"
          width="554"
          height="104"
          loading="lazy"
        />
      </div>
    </div>

    <!-- Coding Activity -->
    <div class="section">
      <h2 class="section-title">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
        {t.about.codingActivityTitle}
      </h2>
      <div class="wakatime-chart" transition:persist="wakatime-chart">
        <img
          class="wakatime-img dark-only"
          src="https://wakatime.com/share/@Dilettante258/82da426f-5fb5-41cf-991a-ea2c9cf12bdd.svg"
          alt="Coding Activity"
          width="719"
          height="132"
          loading="lazy"
        />
        <img
          class="wakatime-img light-only"
          src="https://wakatime.com/share/@Dilettante258/342e0b6d-5547-48fc-8ca9-1d846c38c389.svg"
          alt="Coding Activity"
          width="719"
          height="132"
          loading="lazy"
        />
      </div>
    </div>

    <!-- Education -->
    <div class="section">
      <h2 class="section-title">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M22 10v6M2 10l10-5 10 5-10 5z"></path>
          <path d="M6 12v5c0 1.1 2.7 3 6 3s6-1.9 6-3v-5"></path>
        </svg>
        {t.about.educationTitle}
      </h2>
      <div class="edu-card">
        <div class="edu-main">
          <h3>{education.school[locale]}</h3>
          <p class="edu-college">{education.college[locale]}</p>
          <p class="edu-major">{education.major[locale]}</p>
        </div>
        <span class="edu-period">{education.period}</span>
      </div>
    </div>

    <!-- Work Experience -->
    <div class="section">
      <h2 class="section-title">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
          <path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"></path>
        </svg>
        {t.about.experienceTitle}
      </h2>
      <div class="timeline">
        {
          experiences.map((exp) => (
            <div class:list={["timeline-item", { current: exp.current }]}>
              <div class="timeline-dot" />
              <div class="timeline-card">
                <p class="timeline-period">
                  {exp.period[locale]} · {exp.location[locale]}
                </p>
                <h3 class="timeline-company">
                  {exp.company[locale]}
                  <span class="timeline-dept">{exp.department[locale]}</span>
                </h3>
                <p class="timeline-role">{exp.role[locale]}</p>
              </div>
            </div>
          ))
        }
      </div>
    </div>
  </section>
</SiteLayout>

<style>
  .about-page {
    padding: 2rem 0;
    width: 100%;
    max-width: 100%;
  }

  .subtitle {
    color: var(--muted);
    font-size: 0.9rem;
    margin: 0 0 0.3rem;
  }

  .page-header {
    margin-bottom: 1.5rem;
  }

  .page-header h1 {
    font-family: var(--font-heading);
    margin: 0;
    font-size: 2rem;
    font-weight: 400;
    letter-spacing: -0.01em;
  }

  /* ---- Contact Bar ---- */
  .contact-bar {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 2.5rem;
  }

  .contact-chip {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    padding: 0.4rem 0.8rem;
    border-radius: 8px;
    border: 1px solid var(--stroke);
    color: var(--muted);
    text-decoration: none;
    font-size: 0.85rem;
    transition:
      color 0.15s,
      border-color 0.15s;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }

  .contact-chip:hover {
    color: var(--text);
    border-color: var(--border-hover);
  }

  .contact-chip svg {
    flex-shrink: 0;
  }

  /* ---- Section ---- */
  .section {
    margin-bottom: 2.5rem;
  }

  .section:last-child {
    margin-bottom: 0;
  }

  .section-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-family: var(--font-heading);
    font-size: 1.2rem;
    font-weight: 400;
    margin: 0 0 1rem;
    color: var(--text);
  }

  .section-title svg {
    color: var(--muted);
    flex-shrink: 0;
  }

  /* ---- Tech Stack ---- */
  .tech-stack-icons {
    width: 100%;
  }

  .skill-icons {
    width: 100%;
    max-width: 420px;
    height: auto;
  }

  /* ---- Coding Activity ---- */
  .wakatime-chart {
    max-width: 640px;
    border: 1px solid var(--stroke);
    border-radius: 10px;
    padding: 1rem;
    background: var(--surface);
    transition: border-color 0.15s;
  }

  .wakatime-chart:hover {
    border-color: var(--border-hover);
  }

  .wakatime-img {
    width: 100%;
    height: auto;
    display: block;
  }

  /* ---- Education Card ---- */
  .edu-card {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 1rem;
    border: 1px solid var(--stroke);
    border-radius: 10px;
    padding: 1.2rem;
    width: 100%;
    overflow: hidden;
    background: var(--surface);
    transition: border-color 0.15s;
  }

  .edu-card:hover {
    border-color: var(--border-hover);
  }

  .edu-main {
    flex: 1;
    min-width: 0;
  }

  .edu-card h3 {
    font-family: var(--font-heading);
    margin: 0 0 0.25rem;
    font-size: 1rem;
    font-weight: 400;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .edu-college {
    color: var(--muted);
    margin: 0 0 0.1rem;
    font-size: 0.88rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .edu-major {
    color: var(--muted);
    margin: 0;
    font-size: 0.85rem;
    opacity: 0.7;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .edu-period {
    white-space: nowrap;
    font-size: 0.8rem;
    color: var(--muted);
    flex-shrink: 0;
  }

  /* ---- Timeline ---- */
  .timeline {
    position: relative;
    padding-left: 24px;
    width: 100%;
    overflow: hidden;
  }

  .timeline::before {
    content: "";
    position: absolute;
    left: 5px;
    top: 8px;
    bottom: 8px;
    width: 1px;
    background: var(--stroke);
  }

  .timeline-item {
    position: relative;
    margin-bottom: 0;
  }

  .timeline-dot {
    position: absolute;
    left: -21px;
    top: 1.2rem;
    width: 7px;
    height: 7px;
    border-radius: 50%;
    background: var(--muted);
    z-index: 1;
  }

  .timeline-item.current .timeline-dot {
    background: var(--primary);
    box-shadow: 0 0 0 3px var(--primary-glow);
  }

  .timeline-card {
    border-bottom: 1px solid var(--stroke);
    padding: 1rem 0;
    width: 100%;
    overflow: hidden;
  }

  .timeline-item:last-child .timeline-card {
    border-bottom: none;
  }

  .timeline-period {
    font-size: 0.78rem;
    color: var(--muted);
    margin: 0 0 0.3rem;
    font-variant-numeric: tabular-nums;
  }

  .timeline-company {
    font-family: var(--font-heading);
    margin: 0 0 0.2rem;
    font-size: 1rem;
    font-weight: 400;
    display: flex;
    align-items: baseline;
    gap: 0.5rem;
    flex-wrap: wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .timeline-dept {
    font-family: var(--font-body);
    font-size: 0.85rem;
    color: var(--muted);
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  .timeline-role {
    margin: 0;
    color: var(--muted);
    font-size: 0.88rem;
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* ---- Dark / Light toggle (must be last to override display rules) ---- */
  .light-only {
    display: none;
  }

  :global([data-theme="light"]) .dark-only {
    display: none;
  }

  :global([data-theme="light"]) .light-only {
    display: block;
  }

  /* ---- Responsive ---- */

  /* Tablet (≤768px) */
  @media (max-width: 768px) {
    .page-header h1 {
      font-size: 1.75rem;
    }

    .section {
      margin-bottom: 2rem;
    }

    .wakatime-chart {
      padding: 0.75rem;
    }
  }

  /* Small tablet / large phone (≤600px) */
  @media (max-width: 600px) {
    .page-header {
      margin-bottom: 1.2rem;
    }

    .contact-bar {
      margin-bottom: 2rem;
    }

    .section {
      margin-bottom: 1.75rem;
    }

    .section-title {
      font-size: 1.1rem;
    }

    .edu-card {
      flex-direction: column;
      padding: 1rem;
    }

    .timeline-company {
      flex-direction: column;
      gap: 0.1rem;
    }
  }

  /* Phone (≤480px) */
  @media (max-width: 480px) {
    .about-page {
      padding: 1.25rem 0;
    }

    .page-header h1 {
      font-size: 1.5rem;
    }

    .section {
      margin-bottom: 1.5rem;
    }

    .section-title {
      font-size: 1rem;
      margin-bottom: 0.75rem;
    }

    .wakatime-chart {
      padding: 0.5rem;
      border-radius: 8px;
    }

    .edu-card {
      border-radius: 8px;
    }

    .timeline {
      padding-left: 20px;
    }

    .timeline-dot {
      left: -17px;
      width: 6px;
      height: 6px;
    }

    .timeline-card {
      padding: 0.75rem 0;
    }
  }
</style>
